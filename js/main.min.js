var a = "active";

// no skroll

var block = $("<div>").css({ height: "50px", width: "50px" }),
  indicator = $("<div>").css({ height: "200px" });

$("body").append(block.append(indicator));
var w1 = $("div", block).innerWidth();
block.css("overflow-y", "scroll");
var w2 = $("div", block).innerWidth();
$(block).remove();

var scrollbar = w1 - w2;

$(":root").css("--scroll", scrollbar + "px");

// Ribbon scroll
$(window).scroll(function () {
  $(".ribbon_wrapper").each(function () {
    var e = $(this);

    if ($(window).width() <= 600 - scrollbar) {
      size = -1000;
    } else {
      size = -2000;
    }

    if (
      e.offset().top <= $(window).scrollTop() + $(window).height() * 1.5 &&
      e.offset().top + e.height() >= $(window).scrollTop()
    ) {
      var first = e.find(".ribbon:first-child"),
        last = e.find(".ribbon:last-child"),
        calc_first = size + ($(window).scrollTop() - e.offset().top) / 10;
      calc_last = size - ($(window).scrollTop() - e.offset().top) / 10;

      first.css(
        "transform",
        "rotate(8deg) translate3d(" + calc_first + "px, 0, 0)"
      );
      last.css(
        "transform",
        "rotate(-7deg) translate3d(" + calc_last + "px, 0, 0)"
      );
    }
  });
});

// Roadmap scroll

if ($(".roadmap").length) {
  if ($(window).width() >= 900 - scrollbar) {
    $(document).ready(function () {
      var e = $(".roadmap"),
        width = $(".roadmap_wrapper").width(),
        hh = $(window).width() * 1.5;

      e.height(width + hh);

      $(window).scroll(function () {
        var scroll =
          ($(window).scrollTop() + $(window).height() - e.offset().top) * -1 +
          $(window).width() * 2;

        if (scroll <= e.height() - hh) {
          $(".roadmap_scroll").css(
            "transform",
            "translate3d(" + scroll + "px, 0, 0)"
          );
        }
      });
    });
    var path = document.getElementById("check"),
      width = $("#check").parents("svg").width(),
      len = Math.round(path.getTotalLength()),
      dots = [],
      radial = [];

    $(".roadmap_timelaps").css("width", width);

    $("#dots rect").each(function () {
      dots.push($(this).attr("x"));
    });

    $(".radial").each(function () {
      radial.push(
        $(this)
          .find("rect")
          .attr("transform")
          .split(" ")[0]
          .replace(/[^+\d]/g, "")
      );
    });

    $("#check").attr("stroke-dasharray", len);
    path.style.strokeDashoffset = len;

    $(window).scroll(function () {
      var scroll = $(".roadmap_timelaps").offset().left - $(window).width() / 2,
        scroll = scroll / width,
        scroll = scroll * len;

      if (scroll <= 0) {
        myPlay(scroll);
      }
    });

    function myPlay(scroll) {
      path.style.strokeDashoffset = len + scroll;

      scroll = scroll * -1;

      for (var i = dots.length - 1; i >= 0; i--) {
        dots[i];
        if (scroll >= dots[i]) {
          $("#dots rect").eq(i).css("fill", "var(--green)");
        } else {
          $("#dots rect").eq(i).css("fill", "var(--gray)");
        }
      }

      for (var i = radial.length - 1; i >= 0; i--) {
        radial[i];
        if (scroll >= radial[i]) {
          $(".radial")
            .eq(i)
            .addClass(a)
            .find("path")
            .css("fill", "var(--green)");
        } else {
          $(".radial")
            .eq(i)
            .removeClass(a)
            .find("path")
            .css("fill", "var(--gray)");
        }
      }
    }
  } else {
    var path = document.getElementById("check_mobile"),
      width = $("#check_mobile").parents("svg").height(),
      len = Math.round(path.getTotalLength()),
      dots = [],
      radial = [];

    $("#dots_mobile rect").each(function () {
      dots.push($(this).attr("y"));
    });

    $(".radial_mobile").each(function () {
      radial.push(
        $(this)
          .find("rect")
          .attr("transform")
          .replace(/^[^ ]+/, "")
          .split(")")[0]
      );
    });

    $("#check_mobile").attr("stroke-dasharray", len);
    path.style.strokeDashoffset = len;

    $(window).scroll(function () {
      var scroll =
          $(window).scrollTop() -
          $(".roadmap_timelaps").offset().top +
          $(window).height() / 2,
        scroll = scroll / width,
        scroll = scroll * len;

      if (scroll >= 0 && scroll <= len) {
        myPlay_mobile(scroll);
      }
    });

    function myPlay_mobile(scroll) {
      path.style.strokeDashoffset = len - scroll;

      for (var i = dots.length - 1; i >= 0; i--) {
        dots[i];
        if (scroll >= dots[i]) {
          $("#dots_mobile rect").eq(i).css("fill", "var(--green)");
        } else {
          $("#dots_mobile rect").eq(i).css("fill", "var(--gray)");
        }
      }

      for (var i = radial.length - 1; i >= 0; i--) {
        radial[i];
        if (scroll >= radial[i]) {
          $(".radial_mobile")
            .eq(i)
            .addClass(a)
            .find("path")
            .css("fill", "var(--green)");
        } else {
          $(".radial_mobile")
            .eq(i)
            .removeClass(a)
            .find("path")
            .css("fill", "var(--gray)");
        }
      }
    }
  }
}
